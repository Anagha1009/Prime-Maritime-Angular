<div class="section-title">
    <h2>New Container Movement</h2>
</div>
<div class="container" [formGroup]="cmForm">
    <div class="row">
        <div class="col-md-4">
            <div class="form-group">
                <div class="form-check form-switch">
                    <input (change)="switchToggle($event)" class="form-check-input" type="checkbox" role="switch" />
                    <label class="form-check-label">Enter Container No Manually</label>
                </div>
            </div>
        </div>
        <div class="col-md-6 offset-md-2 text-end">
            <button class="form-btn-primary" #openBtn data-bs-toggle="modal" href="#bookingModal">Upload Excel</button>
        </div>
    </div>
    <div class="row" *ngIf="ismanually">
        <div class="col-md-4">
            <div class="form-group">
                <label class="form-label2">Container No<span class="text-danger">
                        *</span>
                </label>
                <input type="text" class="form-control2" />
            </div>
        </div>
        <div class="col-md-4 mt-4">
            <button type="button" class="form-btn">Get Container</button>
        </div>
    </div>
    <div class="row" *ngIf="!ismanually">
        <div class="col-md-4">
            <div class="form-group">
                <label class="form-label2">Booking No / CRO No<span class="text-danger">
                        *</span>
                </label>
                <input type="text" formControlName="BKCR_NO" class="form-control2" />
            </div>
        </div>
        <div class="col-md-4 mt-4">
            <button type="button" (click)="getCMList()" class="form-btn">Get Container</button>
        </div>
    </div>
    <div class="table-responsive" *ngIf="containerMovementList.length > 0">
        <table class="ratetable" id="data-table-config">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Container No</th>
                    <th>Previous Activity</th>
                    <th>Current Activity</th>
                    <th>Activity Date</th>
                    <th>Location</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of containerMovementList;let i=index">
                    <td>{{i + 1}}</td>
                    <td>{{item.CONTAINER_NO}}</td>
                    <td>{{item.PREV_ACT_CODE == '' || item.PREV_ACT_CODE == null ? '-' : item.PREV_ACT_CODE}}
                        <span
                            *ngIf="!item.PREV_ACT_CODE == '' || !item.PREV_ACT_CODE == null">(</span>{{item.PREV_ACT_NAME}}<span
                            *ngIf="!item.PREV_ACT_CODE == '' || !item.PREV_ACT_CODE == null">)</span>
                    </td>
                    <td>{{item.CURR_ACT_CODE}} ({{item.CURR_ACT_NAME}})</td>
                    <td>{{item.ACTIVITY_DATE | date:'mediumDate'}}</td>
                    <td>{{item.LOCATION}}</td>
                    <td class="status"><span
                            [class]="item.STATUS == 'Hold' ? 'waiting' : item.STATUS == 'Empty' ? 'countered' : item.STATUS == 'Damage' ? 'rejected' : 'active'">{{item.STATUS}}</span>
                    </td>
                    <td>
                        <i (click)="getCM(item)" class="fa fa-eye mx-2 pointer text-dark"></i>
                        <i (click)="getCM(item)" class="fa fa-pencil ms-2 pointer text-success"></i>
                        <i class="d-none" #openModalPopup data-bs-toggle="modal" href="#containerModal">
                        </i>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col-md-5 mx-auto" *ngIf="containerMovementList.length == 0 && isGetContainer">
        <h5 class="text-center">Sorry! No records found !!</h5>
        <img src="assets/img/doimg.jpg" class="img-fluid" alt="">
    </div>
</div>
<div class="modal fade" id="containerModal" aria-labelledby="exampleModalLabel" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Container Movement Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" #closeBtn></button>
            </div>
            <div class="modal-body" [formGroup]="containerMovementForm">
                <h6>Previous : <small class="text-danger">{{containerMovementForm.value.PREV_ACT_CODE == '' ||
                        containerMovementForm.value.PREV_ACT_CODE == null ? '-' :
                        containerMovementForm.value.PREV_ACT_CODE}}
                        <span
                            *ngIf="containerMovementForm.value.PREV_ACT_CODE != null">(</span>{{containerMovementForm.value.PREV_ACT_NAME}}<span
                            *ngIf="containerMovementForm.value.PREV_ACT_CODE != null">)</span></small>
                </h6>
                <h6>Current : <small class="text-danger">{{containerMovementForm.value.CURR_ACT_NAME}}
                        ({{containerMovementForm.value.CURR_ACT_CODE2}})</small></h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label2">Container No
                            </label>
                            <input readonly type="text" formControlName="CONTAINER_NO" class="form-control2" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label2">Next Activity<span class="text-danger">
                                    *</span></label>
                            <select class="form-control2" formControlName="CURR_ACT_CODE">
                                <option value="">--Select--</option>
                                <option value="{{item.NEXT_ACT_CODE}}"
                                    *ngFor="let item of containerMovementForm.value.NEXT_ACTIVITY_LIST" value="">
                                    {{item.NEXT_ACT_NAME}} ({{item.NEXT_ACT_CODE}})</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label2">Status<span class="text-danger">
                                    *</span></label>
                            <select class="form-control2" formControlName="STATUS">
                                <option value="">--Select--</option>
                                <option value="Emergency Repair">Emergency Repair</option>
                                <option value="Full">Full</option>
                                <option value="Empty">Empty</option>
                                <option value="Damage">Damage</option>
                                <option value="Hold">Hold</option>
                                <option value="Awaiting Survey">Awaiting Survey</option>
                                <option value="Available">Available</option>
                                <option value="Awaiting Repair">Awaiting Repair</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label2">Location
                            </label>
                            <input type="text" formControlName="LOCATION" value="" class="form-control2" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label2">Activity Date
                            </label>
                            <input type="date" formControlName="ACTIVITY_DATE" onkeypress="return false"
                                class="form-control2" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" (click)="updateMovement()" class="form-btn">Update Movement</button>
            </div>
        </div>
    </div>
</div>